import { IStorageService } from '../platform/storage/common/storage';
import { ICodeEditorService } from '../editor/browser/services/codeEditorService';
import { IFileDialogService } from '../platform/dialogs/common/dialogs';
import { ILabelService, LabelService } from '../platform/label/common/label';
import { IEditorGroupsService } from '../workbench/services/group/common/editorGroupsService';
import { IPartService } from '../workbench/services/part/common/partService';
import { IHistoryService } from '../workbench/services/history/common/history';
import { IFileService } from '../platform/files/common/files';
import { IEditorService } from '../workbench/services/editor/common/editorService';
import { IWindowsService, IWindowService, } from '../platform/windows/common/windows';
import { ITextFileService } from '../workbench/services/textfile/common/textfiles';
import { IExtensionService } from '../workbench/services/extensions/common/extensions';
import { IExtensionGalleryService, IExtensionManagementService, IExtensionEnablementService, } from '../platform/extensionManagement/common/extensionManagement';
import { IUntitledEditorService, UntitledEditorService, } from '../workbench/services/untitled/common/untitledEditorService';
import { IHashService } from '../workbench/services/hash/common/hashService';
import { IBackupFileService } from '../workbench/services/backup/common/backup';
import { IDecorationsService } from '../workbench/services/decorations/browser/decorations';
import { IPreferencesService } from '../workbench/services/preferences/common/preferences';
import { IJSONEditingService } from '../workbench/services/configuration/common/jsonEditing';
import { ITextModelService } from '../editor/common/services/resolverService';
import { IWorkspacesService } from '../platform/workspaces/common/workspaces';
import { ISearchService, ISearchHistoryService, } from '../platform/search/common/search';
import { IViewletService } from '../workbench/services/viewlet/browser/viewlet';
import { IBroadcastService } from '../platform/broadcast/electron-browser/broadcastService';
import { IBreadcrumbsService, BreadcrumbsService, } from '../workbench/browser/parts/editor/breadcrumbs';
import { IProgressService2 } from '../workbench/services/progress/common/progress';
import { IActivityService } from '../workbench/services/activity/common/activity';
import { IOutputService } from '../workbench/parts/output/common/output';
import { IPanelService } from '../workbench/services/panel/common/panelService';
import { IQuickInputService } from '../platform/quickinput/common/quickInput';
import { IHeapService, HeapService, } from '../workbench/api/electron-browser/mainThreadHeapService';
import { CodeSandboxWindowsService } from './windowsService';
import { EditorService } from '../workbench/services/editor/browser/editorService';
import { ICodeSandboxEditorConnectorService } from './services/codesandbox/common/codesandboxEditorConnector';
import { IRequestService } from '../platform/request/node/request';
import { CodeSandboxRequestService } from './requestService';
import { IPreferencesSearchService } from '../workbench/parts/preferences/common/preferences';
import { PreferencesSearchService } from '../workbench/parts/preferences/electron-browser/preferencesSearch';
import { IClipboardService } from '../platform/clipboard/common/clipboardService';
import { CodeSandboxClipboardService } from './clipboardService';
import { IKeybindingEditingService, KeybindingsEditingService, } from '../workbench/services/keybinding/common/keybindingEditing';
import { ILifecycleService } from '../platform/lifecycle/common/lifecycle';
import { CodeSandboxLifecycleService } from './lifecycleService';
import { Registry } from '../platform/registry/common/platform';
import { Extensions as WorkbenchExtensions, } from '../workbench/common/contributions';
import { IStatusbarService } from '../platform/statusbar/common/statusbar';
import { CodeSandboxStatusbarService } from './statusbarService';
import { getServices } from '../platform/instantiation/common/extensions';
import { SearchHistoryService } from '../workbench/services/search/node/searchHistoryService';
import { HistoryService } from '../workbench/services/history/electron-browser/history';
import { Extensions as ActionBarExtensions, } from '../workbench/browser/actions';
import { SaveParticipant } from './services/codesandbox/saveParticipant';
import { CodeSandboxActivityService } from './activityService';
import { CodeSandboxOutputService } from './outputService';
import { CodeSandboxPanelService } from './panelService';
import { CodeSandboxBroadcastService } from './broadcastService';
import { CodeSandboxWorkspacesService } from './workspacesService';
import { JSONEditingService } from '../workbench/services/configuration/node/jsonEditingService';
import { FileDecorationsService } from '../workbench/services/decorations/browser/decorationsService';
import { SyncDescriptor } from '../platform/instantiation/common/descriptors';
import { CodeSandboxFileService } from './fileService';
import { CodeSandboxExtensionGalleryService } from './extensionGalleryService';
import { CodeSandboxFileDialogService } from './fileDialogService';
import { CodeSandboxExtensionManagementService } from './extensionManagementService';
import { ExtensionEnablementService } from '../platform/extensionManagement/common/extensionEnablementService';
import { WindowService } from '../platform/windows/electron-browser/windowService';
import { CodeSandboxBackupService } from './backupFileService';
import { CodeSandboxExtensionService } from './extensionService';
import { CodeSandboxHashService } from './hashService';
import { EditorPart } from '../workbench/browser/parts/editor/editorPart';
import { StorageService } from '../platform/storage/common/storageService';
import { ViewletService } from '../workbench/services/viewlet/browser/viewletService';
import { CodeSandboxWorkbench } from './workbench';
import { TextFileService } from '../workbench/services/textfile/electron-browser/textFileService';
import { TextModelResolverService } from '../workbench/services/textmodelResolver/common/textModelResolverService';
import { CodeSandboxSearchService } from './searchService';
import { CodeEditorService } from '../workbench/services/codeEditor/browser/codeEditorService';
import { CodeSandboxEditorConnectorService } from './services/codesandbox/browser/codesandboxEditorConnectorService';
import { PreferencesService } from '../workbench/services/preferences/browser/preferencesService';
import { ProgressService2 } from '../workbench/services/progress/browser/progressService2';
import { QuickInputService } from '../workbench/browser/parts/quickinput/quickInput';
import { QuickOpenController } from '../workbench/browser/parts/quickopen/quickOpenController';
import { IQuickOpenService } from '../platform/quickOpen/common/quickOpen';
import { CodeSandboxEnvironmentService } from './environmentService';
import { IEnvironmentService } from '../platform/environment/common/environment';
import { CodeSandboxKeybindingService } from './keybindingService';
import { IKeybindingService } from '../platform/keybinding/common/keybinding';
import { ICodeSandboxService } from './services/codesandbox/common/codesandbox';
import { CodeSandboxService } from './services/codesandbox/browser/codesandboxService';
export function loadCodesandboxServices(serviceCollection, instantiationService, overrides) {
    // The or case in this serviceCollection should never happen, we still put it in here to trick
    // the treeshaker to include it.
    serviceCollection.set(ICodeSandboxService, overrides.codesandboxService(instantiationService) ||
        instantiationService.createInstance(CodeSandboxService));
    serviceCollection.set(IEnvironmentService, instantiationService.createInstance(CodeSandboxEnvironmentService));
    var existingKeybindingService = serviceCollection.get(IKeybindingService);
    if (existingKeybindingService) {
        existingKeybindingService.dispose();
    }
    var keybindingService = instantiationService.createInstance(CodeSandboxKeybindingService, window);
    serviceCollection.set(IKeybindingService, keybindingService);
    serviceCollection.set(IStatusbarService, new SyncDescriptor(CodeSandboxStatusbarService));
    serviceCollection.set(IRequestService, new SyncDescriptor(CodeSandboxRequestService));
    serviceCollection.set(IClipboardService, new SyncDescriptor(CodeSandboxClipboardService));
    serviceCollection.set(ILabelService, new SyncDescriptor(LabelService));
    serviceCollection.set(IActivityService, new SyncDescriptor(CodeSandboxActivityService));
    serviceCollection.set(IOutputService, new SyncDescriptor(CodeSandboxOutputService));
    serviceCollection.set(IPanelService, new SyncDescriptor(CodeSandboxPanelService));
    serviceCollection.set(IBreadcrumbsService, new SyncDescriptor(BreadcrumbsService));
    serviceCollection.set(IBroadcastService, new SyncDescriptor(CodeSandboxBroadcastService, 1));
    serviceCollection.set(IWorkspacesService, new SyncDescriptor(CodeSandboxWorkspacesService));
    serviceCollection.set(IJSONEditingService, new SyncDescriptor(JSONEditingService));
    serviceCollection.set(IDecorationsService, new SyncDescriptor(FileDecorationsService));
    serviceCollection.set(IBackupFileService, new SyncDescriptor(CodeSandboxBackupService));
    var lifecycleService = instantiationService.createInstance(CodeSandboxLifecycleService);
    serviceCollection.set(ILifecycleService, lifecycleService);
    serviceCollection.set(IFileService, new SyncDescriptor(CodeSandboxFileService));
    serviceCollection.set(IWindowsService, new SyncDescriptor(CodeSandboxWindowsService));
    serviceCollection.set(IWindowService, new SyncDescriptor(WindowService, 1, {}));
    serviceCollection.set(IExtensionGalleryService, new SyncDescriptor(CodeSandboxExtensionGalleryService));
    serviceCollection.set(IFileDialogService, new SyncDescriptor(CodeSandboxFileDialogService));
    serviceCollection.set(IExtensionManagementService, new SyncDescriptor(CodeSandboxExtensionManagementService));
    serviceCollection.set(IExtensionEnablementService, new SyncDescriptor(ExtensionEnablementService));
    serviceCollection.set(IExtensionService, new SyncDescriptor(CodeSandboxExtensionService));
    serviceCollection.set(IHashService, new SyncDescriptor(CodeSandboxHashService));
    serviceCollection.set(IEditorGroupsService, new SyncDescriptor(EditorPart, 'codesandbox-editor', false));
    serviceCollection.set(IStorageService, new StorageService(localStorage, localStorage));
    serviceCollection.set(IViewletService, new SyncDescriptor(ViewletService, {
        onDidViewletOpen: function () { return true; },
        onDidViewletClose: function () { return true; },
    }));
    serviceCollection.set(IPartService, new SyncDescriptor(CodeSandboxWorkbench));
    serviceCollection.set(IUntitledEditorService, new SyncDescriptor(UntitledEditorService));
    serviceCollection.set(IEditorService, new SyncDescriptor(EditorService));
    serviceCollection.set(ISearchService, new SyncDescriptor(CodeSandboxSearchService));
    serviceCollection.set(IHistoryService, new SyncDescriptor(HistoryService));
    serviceCollection.set(ITextFileService, new SyncDescriptor(TextFileService));
    serviceCollection.set(ITextModelService, new SyncDescriptor(TextModelResolverService));
    serviceCollection.set(ICodeEditorService, instantiationService.createInstance(CodeEditorService));
    serviceCollection.set(ICodeSandboxEditorConnectorService, instantiationService.createInstance(CodeSandboxEditorConnectorService));
    serviceCollection.set(IPreferencesSearchService, new SyncDescriptor(PreferencesSearchService));
    serviceCollection.set(IPreferencesService, new SyncDescriptor(PreferencesService));
    serviceCollection.set(IKeybindingEditingService, new SyncDescriptor(KeybindingsEditingService));
    serviceCollection.set(IProgressService2, new SyncDescriptor(ProgressService2));
    serviceCollection.set(IQuickOpenService, instantiationService.createInstance(QuickOpenController));
    serviceCollection.set(IQuickInputService, new SyncDescriptor(QuickInputService));
    serviceCollection.set(IHeapService, new SyncDescriptor(HeapService));
    serviceCollection.set(ISearchHistoryService, new SyncDescriptor(SearchHistoryService));
    Registry.as(WorkbenchExtensions.Workbench).start(instantiationService, lifecycleService);
    Registry.as(ActionBarExtensions.Actionbar).setInstantiationService(instantiationService);
    instantiationService.createInstance(SaveParticipant);
    // Contributed services
    var contributedServices = getServices();
    for (var _i = 0, contributedServices_1 = contributedServices; _i < contributedServices_1.length; _i++) {
        var contributedService = contributedServices_1[_i];
        serviceCollection.set(contributedService.id, contributedService.descriptor);
    }
}
